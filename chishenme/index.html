<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>食物选择器 | 三餐管理</title>
    <style>
        :root {
            /* 默认主题色（早餐） */
            --primary-color: #FFC107; /* 黄色 */
            --primary-hover: #FFA000;
            --text-color: #333;
            --border-color: #e0e0e0;
        }

        /* 动态主题色设置 */
        .theme-breakfast {
            --primary-color: #FFC107; /* 早餐黄 */
            --primary-hover: #FFA000;
        }
        .theme-lunch {
            --primary-color: #F44336; /* 午餐红 */
            --primary-hover: #D32F2F;
        }
        .theme-dinner {
            --primary-color: #2196F3; /* 晚餐蓝 */
            --primary-hover: #1976D2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'STXihei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-color);
            position: relative;
            overflow: auto;
            transition: background 0.5s ease; /* 主题色过渡效果 */
        }
        
        /* 水墨背景效果 */
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(200, 200, 200, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(180, 180, 180, 0.1) 0%, transparent 40%);
            pointer-events: none;
            z-index: -1;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 500px;
            padding: 30px;
            border: 1px solid var(--border-color);
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
            position: relative;
        }
        
        h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        /* 餐别选择器 */
        .meal-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .meal-btn {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 8px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .meal-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        /* 结果展示区 */
        #display {
            background: #f8f8f8;
            border-radius: 12px;
            padding: 30px 20px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid #e8e8e8;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        #result-food {
            font-size: 2.2rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 12px;
        }
        
        #result-calories {
            font-size: 1.2rem;
            color: #666;
            background: #eee;
            padding: 6px 15px;
            border-radius: 20px;
            margin-top: 10px;
        }
        
        .rolling {
            animation: shake 0.15s infinite;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(-3px); }
            50% { transform: translateX(3px); }
        }
        
        /* 控制按钮 */
        #control-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 14px 0;
            font-size: 1.2rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin: 15px 0;
        }
        
        #control-btn:hover {
            background: var(--primary-hover);
        }
        
        /* 食物管理区 */
        .management-section {
            border-top: 1px solid #e8e8e8;
            padding-top: 25px;
            margin-top: 20px;
        }
        
        h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--text-color);
            text-align: center;
        }
        
        /* 竖向排列的表单 */
        .add-food-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
        }
        
        #new-food, #calories-input, #calories-unit {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            background: #fafafa;
        }
        
        #add-food-btn {
            background: #555;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            font-weight: 500;
            margin-top: 10px;
        }
        
        #add-food-btn:hover {
            background: #666;
        }
        
        /* 食物列表 */
        .food-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            max-height: 250px;
            overflow-y: auto;
            padding: 10px 5px;
            border: 1px solid #eee;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .food-card {
            background: #fff;
            border: 1px solid #e8e8e8;
            border-radius: 8px;
            padding: 12px 8px;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
        }
        
        .food-name {
            font-weight: 500;
            margin-bottom: 6px;
            color: #333;
        }
        
        .food-calories {
            font-size: 0.85rem;
            color: #777;
        }
        
        .delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #888;
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 管理按钮组 */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background: #f8f8f8;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
        }
        
        .action-btn:hover {
            background: #eee;
        }
        
        #clear-btn {
            background: #f0f0f0;
            color: #d32f2f;
            border-color: #ffcdd2;
        }
        
        #clear-btn:hover {
            background: #ffebee;
        }
        
        /* 响应式设计 */
        @media (max-width: 480px) {
            .container { padding: 20px; }
            h1 { font-size: 1.6rem; }
            #result-food { font-size: 1.8rem; }
        }
    </style>
</head>
<body class="theme-breakfast"> <!-- 默认早餐主题 -->
    <div class="container">
        <div class="header">
            <h1>今日餐食选择</h1>
            <div class="meal-selector">
                <button class="meal-btn active" data-meal="breakfast">早餐</button>
                <button class="meal-btn" data-meal="lunch">午餐</button>
                <button class="meal-btn" data-meal="dinner">晚餐</button>
            </div>
        </div>
        
        <div id="display">
            <div id="result-food">请选择餐别后开始</div>
            <div id="result-calories"></div>
        </div>
        
        <button id="control-btn">开始选择</button>
        
        <div class="management-section">
            <h2>菜单管理</h2>
            
            <!-- 竖向排列的表单 -->
            <div class="add-food-form">
                <div class="input-group">
                    <label>食物名称</label>
                    <input type="text" id="new-food" placeholder="例如：牛肉面">
                </div>
                
                <div class="input-group">
                    <label>热量值</label>
                    <input type="number" id="calories-input" placeholder="例如：150">
                </div>
                
                <div class="input-group">
                    <label>单位</label>
                    <select id="calories-unit">
                        <option value="perItem">Kcal/个</option>
                        <option value="per100g">Kcal/100g</option>
                    </select>
                </div>
                
                <button id="add-food-btn">添加至菜单</button>
            </div>
            
            <div class="food-grid">
                <!-- 食物卡片由JS动态生成 -->
            </div>
            
            <div class="action-buttons">
                <button id="clear-btn" class="action-btn">清空当前菜单</button>
                <button id="reset-btn" class="action-btn">重置所有数据</button>
            </div>
        </div>
    </div>

    <script>
        // 默认食物数据（驴打滚）
        const DEFAULT_FOOD = {
            name: "驴打滚",
            calories: 198,
            unit: "per100g"
        };
        
        // 当前选择的餐别
        let currentMeal = 'breakfast';
        
        // 数据结构：按餐别存储食物列表
        let mealData = {
            breakfast: JSON.parse(localStorage.getItem('breakfastFoods')) || [DEFAULT_FOOD],
            lunch: JSON.parse(localStorage.getItem('lunchFoods')) || [DEFAULT_FOOD],
            dinner: JSON.parse(localStorage.getItem('dinnerFoods')) || [DEFAULT_FOOD]
        };
        
        // DOM元素
        const foodNameEl = document.getElementById('result-food');
        const caloriesEl = document.getElementById('result-calories');
        const controlBtn = document.getElementById('control-btn');
        const foodGrid = document.querySelector('.food-grid');
        const newFoodInput = document.getElementById('new-food');
        const caloriesInput = document.getElementById('calories-input');
        const caloriesUnit = document.getElementById('calories-unit');
        const addFoodBtn = document.getElementById('add-food-btn');
        const clearBtn = document.getElementById('clear-btn');
        const resetBtn = document.getElementById('reset-btn');
        const mealBtns = document.querySelectorAll('.meal-btn');
        const body = document.body;
        
        // 状态变量
        let isRolling = false;
        let rollInterval;
        let selectedFood = null;

        /* ========== 初始化页面 ========== */
        function initPage() {
            // 设置默认餐别
            setActiveMeal(currentMeal);
            
            // 渲染食物列表
            renderFoodGrid();
            
            // 绑定餐别切换事件
            mealBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    currentMeal = this.dataset.meal;
                    setActiveMeal(currentMeal);
                    applyTheme(currentMeal); // 应用主题色
                    renderFoodGrid();
                    resetDisplay();
                });
            });
        }
        
        // 设置当前餐别主题色
        function applyTheme(meal) {
            // 移除旧主题类
            body.classList.remove('theme-breakfast', 'theme-lunch', 'theme-dinner');
            
            // 应用新主题类
            body.classList.add(`theme-${meal}`);
        }
        
        // 设置当前餐别激活状态
        function setActiveMeal(meal) {
            mealBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.meal === meal);
            });
        }
        
        // 重置结果显示
        function resetDisplay() {
            foodNameEl.textContent = "请点击开始选择";
            caloriesEl.textContent = "";
        }

        /* ========== 食物列表渲染 ========== */
        function renderFoodGrid() {
            const foods = mealData[currentMeal];
            foodGrid.innerHTML = '';
            
            if (foods.length === 0) {
                foodGrid.innerHTML = '<div class="empty-tip">暂无食物，请添加</div>';
                return;
            }
            
            foods.forEach((food, index) => {
                const card = document.createElement('div');
                card.className = 'food-card';
                card.dataset.index = index;
                
                // 根据单位显示不同的热量标签
                const unitLabel = food.unit === 'perItem' ? '个' : '100g';
                const caloriesText = `${food.calories} kcal/${unitLabel}`;
                
                card.innerHTML = `
                    <div class="food-name">${food.name}</div>
                    <div class="food-calories">${caloriesText}</div>
                    <button class="delete-btn">×</button>
                `;
                
                foodGrid.appendChild(card);
                
                // 删除功能
                card.querySelector('.delete-btn').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteFood(index);
                });
            });
        }
        
        /* ========== 核心选择功能 ========== */
        function getRandomFood() {
            const foods = mealData[currentMeal];
            if (foods.length === 0) return null;
            const randomIndex = Math.floor(Math.random() * foods.length);
            return foods[randomIndex];
        }
        
        function startRolling() {
            const foods = mealData[currentMeal];
            if (foods.length === 0) {
                alert('当前菜单为空，请先添加食物');
                return;
            }
            
            isRolling = true;
            controlBtn.textContent = '停止选择';
            foodNameEl.classList.add('rolling');
            caloriesEl.textContent = "";
            
            // 快速切换食物
            rollInterval = setInterval(() => {
                const food = getRandomFood();
                foodNameEl.textContent = food.name;
            }, 150);
        }
        
        function stopRolling() {
            clearInterval(rollInterval);
            isRolling = false;
            controlBtn.textContent = '开始选择';
            foodNameEl.classList.remove('rolling');
            
            // 确定最终选择
            selectedFood = getRandomFood();
            foodNameEl.textContent = selectedFood.name;
            
            // 显示热量信息
            showCaloriesInfo(selectedFood);
        }
        
        // 显示热量信息（根据存储的单位）
        function showCaloriesInfo(food) {
            const unitLabel = food.unit === 'perItem' ? '个' : '100g';
            caloriesEl.textContent = `热量: ${food.calories} kcal/${unitLabel}`;
        }

        /* ========== 食物管理功能 ========== */
        function addNewFood() {
            const foodName = newFoodInput.value.trim();
            const calories = parseFloat(caloriesInput.value);
            const unit = caloriesUnit.value;
            
            if (!foodName) {
                alert('请输入食物名称');
                return;
            }
            
            if (isNaN(calories) || calories <= 0) {
                alert('请输入有效的热量值');
                return;
            }
            
            const foods = mealData[currentMeal];
            if (foods.some(f => f.name === foodName)) {
                alert('该食物已在当前菜单中');
                return;
            }
            
            // 添加到当前餐别菜单
            foods.push({ 
                name: foodName, 
                calories: calories,
                unit: unit
            });
            
            saveFoods();
            renderFoodGrid();
            
            // 清空表单
            newFoodInput.value = '';
            caloriesInput.value = '';
            
            // 添加成功提示
            showToast(`已添加: ${foodName}`);
        }
        
        function deleteFood(index) {
            const foods = mealData[currentMeal];
            if (confirm(`确定要删除 "${foods[index].name}" 吗？`)) {
                foods.splice(index, 1);
                saveFoods();
                renderFoodGrid();
                
                // 如果删除的是当前选中的食物
                if (selectedFood && selectedFood.name === foods[index]?.name) {
                    resetDisplay();
                }
            }
        }
        
        function clearCurrentMenu() {
            if (confirm(`确定要清空${getMealName(currentMeal)}的全部食物吗？`)) {
                mealData[currentMeal] = [];
                saveFoods();
                renderFoodGrid();
                resetDisplay();
            }
        }
        
        function resetAllData() {
            if (confirm('确定要重置所有餐别的数据吗？此操作不可恢复！')) {
                // 重置为只包含默认食物
                mealData = {
                    breakfast: [DEFAULT_FOOD],
                    lunch: [DEFAULT_FOOD],
                    dinner: [DEFAULT_FOOD]
                };
                saveFoods();
                renderFoodGrid();
                resetDisplay();
                showToast('已重置所有数据');
            }
        }
        
        // 获取餐别中文名称
        function getMealName(mealType) {
            const names = {
                breakfast: '早餐',
                lunch: '午餐',
                dinner: '晚餐'
            };
            return names[mealType] || '';
        }
        
        /* ========== 数据存储 ========== */
        function saveFoods() {
            localStorage.setItem('breakfastFoods', JSON.stringify(mealData.breakfast));
            localStorage.setItem('lunchFoods', JSON.stringify(mealData.lunch));
            localStorage.setItem('dinnerFoods', JSON.stringify(mealData.dinner));
        }
        
        /* ========== 辅助功能 ========== */
        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.7);
                color: white;
                padding: 12px 25px;
                border-radius: 8px;
                z-index: 1000;
                animation: fadeInOut 3s forwards;
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.5s forwards';
                setTimeout(() => toast.remove(), 500);
            }, 2500);
        }

        /* ========== 事件监听 ========== */
        controlBtn.addEventListener('click', () => {
            isRolling ? stopRolling() : startRolling();
        });
        
        addFoodBtn.addEventListener('click', addNewFood);
        
        // 回车键添加食物
        newFoodInput.addEventListener('keypress', e => e.key === 'Enter' && addNewFood());
        caloriesInput.addEventListener('keypress', e => e.key === 'Enter' && addNewFood());
        
        clearBtn.addEventListener('click', clearCurrentMenu);
        resetBtn.addEventListener('click', resetAllData);
        
        // 空格键支持
        document.addEventListener('keydown', e => {
            if (e.code === 'Space') {
                e.preventDefault();
                controlBtn.click();
            }
        });
        
        // 初始化页面
        initPage();
    </script>
</body>
</html>
